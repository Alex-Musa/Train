<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

</head>

<style>
    body {
        max-width: 80%;
        margin-left: auto;
        margin-right: auto;
    }

    .jumbotron-fluid {
        text-align: center;
        width: 137%;
        margin: 15px 50px 15px -205px;
        text-align: center"

    }

    .panel-title {
        text-align: center
    }
</style>

<body>
    <div class="container">
        <div class="jumbotron jumbotron-fluid">
            <div class="container">
                <h1 class="display-4">Train Time
                </h1>
                <p class="lead">This is a modified jumbotron that occupies the entire horizontal space of its parent.
                </p>
            </div>
        </div>
    </div>

    <div class="card card-default">
        <div class="card-body">

            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title"><strong>Current Train Schedule</strong></h3>
                </div>

                <table class="table table-hover" id='train-table'>
                    <thead>
                        <tr>
                            <th>Train Name</th>
                            <th>Destination</th>
                            <th>Frequency (min)</th>
                            <th>Next Arrival</th>
                            <th>Minutes Away</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>


            </div>
        </div>
    </div>

    <br>

    <div class="card card-default">
        <div class="card-body">

            <form>
                <div class="form-group">
                    <label for="train-name-input">Train Name</label>
                    <input type="text" class="form-control" id="train-name-input">
                </div>
                <div class="form-group">
                    <label for="destination-input">Destination</label>
                    <input type="text" class="form-control" id="destination-input">
                </div>
                <div class="form-group">
                    <label for="first-train-input">First Train Time (HH:mm - military time)</label>
                    <input type="text" class="form-control" id="first-train-input">
                </div>
                <div class="form-group">
                    <label for="frequency-input">Frequency (min)</label>
                    <input type="text" class="form-control" id="frequency-input">
                </div>
                <button type="submit" class="btn btn-primary" id="add-train-btn">Submit</button>
            </form>

        </div>


        <script>












            $(document).ready(function () {
                $("#add").click(function () {
                    event.preventDefault();
                    var tName = $("#tName").val();
                    var dest = $("#dest").val();
                    var startTime = $("#startTime").val();
                    var freq = $("#freq").val();
                    var firstTimeConverted = moment(startTime, "HH:mm").subtract(1, "years");
                    var currentTime = moment();
                    var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
                    var tRemainder = diffTime % freq;
                    var minAway = freq - tRemainder;

                    var nextTrain = moment().add(minAway, "minutes");
                    var next = moment(nextTrain).format("HH:mm")
                    console.log(minAway)
                    console.log(next)

                    console.log("Hello");

                    tName = $("#tName").val().trim();
                    dest = $("#dest").val().trim();
                    startTime = $("#startTime").val().trim();
                    freq = $("#freq").val().trim();



                    database.ref().push({
                        tName: tName,
                        dest: dest,
                        startTime: startTime,
                        freq: freq,
                        trainTime: next,
                        nextTrain: minAway
                    });
                });
            });
            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyDjl4J7P2TQeTwgCO6ylVx8jBKZ6Nm698c",
                authDomain: "train-f714e.firebaseapp.com",
                databaseURL: "https://train-f714e.firebaseio.com",
                projectId: "train-f714e",
                storageBucket: "",
                messagingSenderId: "366915920924",
                appId: "1:366915920924:web:3ad5190ebc544866"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);

            //initial values
            var tName = "";
            var dest = "";
            var startTime = "";
            var freq = "";


            database.ref().on("child_added", function (snapshot) {
                var sv = snapshot.val();

                console.log(sv.minAway)
                $("table tbody").append("<tr>
                    < th > " + sv.tName + "</th >
                    <td>" + sv.dest + "</td>
                    <td>" + sv.freq + "</td>
                    <td>" + sv.trainTime + "</td>
                    <td>" + sv.nextTrain + "</td>
        </tr > ");


        })

        </script>

        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>

</body>

</html>